---
layout: post
title:  "简介" 
permalink: jkdoc/performance1.html
type: manual
element: optimizingPerformance
version: Egret引擎 v1.6.1
---
       
# 第一章：简介

本文档通过开发中所遇到的问题，为部署与优化程序的开发人员介绍最佳实践。

优化游戏性能以便获得最佳体验是非常重要的，针对移动设备尤其重要。通过下面几个技巧使你开发的移动游戏更好的运行在移动设备：
        
* 少使用Alpha混合。
* 显式停止计时器，让它们准备好进行垃圾回收。
* 使用弱事件侦听器并在不需要时删除这些侦听器。
* 在不需要触摸交互性时显式禁用触摸交互性。
* 合理使用dispatchEvents 函数。
* 尽可能重用对象，建立对象池，而不创建对象并对其执行垃圾回收。
* 多次调用类属性时，避免直接使用this.att，建立局部变量赋值。
* Event.ENTER_FRAME数量控制。
* 减少不必要的引用。 
* 减少显示对象的旋转缩放。
* 使用SpriteSheet合并的图片尺寸要优于单张图片的总尺寸，尤其是带透明通道的。
* 在Http请求中，加载单个文件速度要优于加载多个文件。

根据游戏进程，合理使用处理器是性能优化的关键，很多设定不被推荐的原因是处理器很忙。改进性能有一些常规的方法，降低内存的使用量，降CPU的使用量,是否可以调用GPU等等，始终牢记预期与用户的体验是优化的关键。

在程序开发中，常见的一个建议是”避免过早优化”,也许某些性能优化需要难以理解或读懂的代码去实现，此类代码优化后难以维护。

Egret为开源免费引擎，为更好的发展，请给我们GitHub一颗小星星：
https://github.com/egret-labs/egret-core

在阅读中发现有误， 我们会最快响应：
E-mail：yangxiao@egret.com

  

### 运行时代码执行基本原理

优化的关键在于了解运行的原理，在引擎的设计中，Egret底层使用了”弹性跑道模型”即各种操作都是针对每”帧”发生的。

例如：我们指定帧速率为30帧/秒,则运行时会尝试使每个帧的执行时间为三十分之一秒。

每个帧循环包括两个阶段，三部分：enterFrame 事件、事件和呈现。

第一阶段包括两部分（enterFrame 事件和事件），第一部分是派发一次enterFrame事件，第二部分是调度运行时的事件。
第二阶段是第一阶段所有事件调度后会执行clear后，帧循环的呈现阶段开始。此时，运行时将计算屏幕上所有可见元素的状态并将其绘制到屏幕上。然后，此进程重复，就像赛跑者围绕跑道奔跑。

最简单的方法是假设帧循环中的两个阶段需要相同的时间。在这种情况下，一半的时间运行帧循环事件处理函数和应用程序代码，另一半的时间发生呈现。但是，事实通常是不同的。有时，应用程序代码会通过增加运行时间并减少用于呈现的时间来占用帧中多一半的可用时间。在其他情况下，特别是对于混合模式等复杂的可见内容，呈现需要一半以上的帧时间。由于各阶段需要的实际时间是灵活的，所以帧循环常称为“弹性跑道”。

如果帧循环的组合操作（代码执行和呈现）所需时间太长，运行时将无法保持帧速率。帧会进行扩展，所需时间超过其分配的时间，因此在触发下个帧之前会出现延迟。例如，如果一个帧循环需要的时间超过三十分之一秒，则运行时不能以每秒三十帧的速度更新屏幕。如果帧速率减慢，将影响体验效果。最乐观的情况是动画断断续续。如果情况更糟糕，可能画面停止，或程序崩溃。



### 体验反馈与实际性能

根据操作的运行时与创建对象实例数来度量游戏性能：

* 动画是流畅还是断断续续？
* 音频是连续播放还是暂停再恢复播放？
* 键入时，文本输入保持同步还是有些延迟？
* 如果单击，会立即发生某些情况还是存在延迟？
* PC应用程序运行时，CPU 风扇声音是否会变大？
* 在便携式计算机或移动设备上运行应用程序时，电池是否会很快耗尽？
* 开启egret.Profiler.getInstance().run();

通过上述度量，了解程序代码的执行性能方法，这里只是部分，如果有更好的，欢迎给我们E-mail。

